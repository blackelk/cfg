#!/home/c/venvs/pylint/bin/python
"""
Wrapper for pylint
Hide noisy lines.
Colorize errors and TODOs
"""
import re
import subprocess
import sys

from hell import *

SKIP_PATTERNS = [
    'Unused import (C|T|M|L|I|F|PP|P|print_to_str|Config|ATTR_SHORTCUTS|COLOR_SHORTCUTS|rlcompleter|readline|termcolor|sys|pprint|inspect|code) from wildcard import',
    'Wildcard import hell',
    r"Class '\w+' has no 'objects' member",
    r"Class '\w+' has no 'DoesNotExist' member",
]

COLOR_PATTERNS = {
    'red': [
        r'\d: E\d{4}',
    ],
    'blue': [
        re.compile(': TODO:', re.I),
    ],
}


def get_line_color(line):
    for color, color_patterns in COLOR_PATTERNS.items():
        for color_pattern in color_patterns:
            if re.search(color_pattern, line):
                return color
    return 'white'


args = sys.argv[1:].copy()

if '--strict' in args:
    args.remove('--strict')
    args.append('--rcfile=/dev/null')

p = subprocess.run(['/home/c/venvs/pylint/bin/pylint'] + args,
                   capture_output=True)

for line in p.stdout.decode().splitlines():
    for skip_pattern in SKIP_PATTERNS:
        if re.search(skip_pattern, line):
            break
    else:
        color = get_line_color(line)
        C(line, c=color)
